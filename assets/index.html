<!doctype html>
<html lang="en" ng-app="zugttApp">
<head>
  <meta charset="utf-8">
  <title>Zugsteuerung - TT</title>
  <link rel="stylesheet" href="bower_components/bootstrap/dist/css/bootstrap.css">
  <script src="bower_components/angular/angular.js"></script>
  <style>
  zugtt-switch,zugtt-buzzer{
    display: block;
    position: absolute;
    width: 35px;
    height: 35px;
    font-weight: bold;
    color: #fff;
    text-align:center;
    line-height: 35px;
    cursor: pointer;
    user-select: none;
    background-color: rgba(0,0,0,0.55);
  }
  zugtt-rail {
    position: absolute;
    width: 140px;
    height: 16px;
    font-weight: bold;
    color: #fff;
    text-align: center;
    cursor: pointer;
    user-select: none;
    background-color: rgba(0,0,0,0.55);
    line-height: 18px;
  }
   .status {
    font-size: 9px;
    position: absolute;
    right: 2px;
    top: -10px;
  }
  .active {
    box-shadow: 0px 0px 17px 2px #FBF77E;
  }
  zugtt-rail div.icon,zugtt-light div.icon {
    position: absolute;
    display: block;
    right: 10px;
    top: 0px;
  }
  zugtt-signal {
    position: absolute;
    user-select: none;
    cursor: pointer;
  }
  zugtt-signal div {
    width: 20px;
    height: 20px;
    background-color: rgba(0,0,0,0.55);
    border-radius: 10px;
  }
  zugtt-signal .red {
    background-color: rgba(255,0,0,0.55); 
  }
  zugtt-signal .green {
    background-color: rgba(74,255,0,0.55);
  }
  zugtt-signal .greenYellow {
    background-image: linear-gradient(rgba(74,255,0,0.55) 0%, rgba(74,255,0,0.55) 50%,yellow 50%,yellow 100%);
  }
  zugtt-signal .redWhite {
    background-image: linear-gradient(rgba(255,0,0,0.55) 0%,rgba(255,0,0,0.55) 50%,rgba(255,255,255,1) 50%,rgba(255,255,255,1) 100%);
  }
  zugtt-light {
    display: block;
    position: absolute;
    width: 45px;
    height: 35px;
    font-weight: bold;
    color: #fff;
    text-align:left;
    line-height: 35px;
    cursor: pointer;
    user-select: none;
    background-color: rgba(0,0,0,0.55);
  
  }
  zugtt-light ng-transclude {
    margin-left: 8px;
  }
  </style>
</head>
<body ng-controller="appController" style="background-image: url('bg.jpg');background-repeat:no-repeat;">
<div style="position:absolute;left:-364px">
<zugtt-switch zugtt-straight-channel="0" zugtt-bent-channel="1" style="left:725px;top:650px;">1</zugtt-switch>
<zugtt-switch zugtt-straight-channel="2" zugtt-bent-channel="3" style="left:772px;top:642px;">2</zugtt-switch>
<zugtt-switch zugtt-straight-channel="4" zugtt-bent-channel="5" style="left:825px;top:610px;">3</zugtt-switch>
<zugtt-switch zugtt-straight-channel="6" zugtt-bent-channel="7" style="left:1200px;top:360px;">4</zugtt-switch>
<zugtt-switch zugtt-straight-channel="8" zugtt-bent-channel="9" style="left:1254px;top:330px;">5</zugtt-switch>
<zugtt-switch zugtt-straight-channel="10" zugtt-bent-channel="11" style="left:1310px;top:250px;">6</zugtt-switch>

<zugtt-switch zugtt-straight-channel="12" zugtt-bent-channel="13" style="left:705px;top:670px;">10</zugtt-switch>
<zugtt-switch zugtt-straight-channel="14" zugtt-bent-channel="15" style="left:600px;top:710px;">11</zugtt-switch>
<zugtt-switch zugtt-straight-channel="16" zugtt-bent-channel="17" style="left:470px;top:670px;">12</zugtt-switch>
<zugtt-switch zugtt-straight-channel="18" zugtt-bent-channel="19" style="left:446px;top:610px;">13</zugtt-switch>
<zugtt-switch zugtt-straight-channel="20" zugtt-bent-channel="21" style="left:1366px;top:566px;">14</zugtt-switch>
<zugtt-switch zugtt-straight-channel="22" zugtt-bent-channel="23" style="left:1346px;top:520px;">15</zugtt-switch>

<zugtt-switch zugtt-straight-channel="24" zugtt-bent-channel="25" style="left:1342px;top:460px;">16</zugtt-switch>
<zugtt-switch zugtt-straight-channel="26" zugtt-bent-channel="27" style="left:600px;top:310px;">17</zugtt-switch>
<zugtt-switch zugtt-straight-channel="28" zugtt-bent-channel="29" style="left:970px;top:280px;">18</zugtt-switch>

<zugtt-rail zugtt-rail-channel="30" style="left:870px;top:721px;"></zugtt-rail>
<zugtt-rail zugtt-rail-channel="31" style="left:870px;top:702px;"></zugtt-rail>
<zugtt-rail zugtt-rail-channel="32" style="left:870px;top:682px;"></zugtt-rail>
<zugtt-rail zugtt-rail-channel="33" style="left:870px;top:661px;"></zugtt-rail>

<zugtt-rail zugtt-rail-channel="34" style="left:720px;top:297px;transform:rotate(-2deg);"></zugtt-rail>
<zugtt-rail zugtt-rail-channel="35" style="left:720px;top:312px;transform:rotate(-2deg);"></zugtt-rail>

<zugtt-signal zugtt-red-channel="36" zugtt-green-channel="37" style="left:810px;top:659px;"></zugtt-signal>
<zugtt-signal zugtt-red-channel="38" zugtt-green-channel="39" style="left:760px;top:680px;"></zugtt-signal>
<zugtt-signal zugtt-red-channel="40" zugtt-green-channel="41" style="left:760px;top:700px;"></zugtt-signal>
<zugtt-signal zugtt-red-channel="42" zugtt-green-channel="43" style="left:660px;top:719px;"></zugtt-signal>

<zugtt-signal zugtt-red-channel="44" zugtt-green-channel="45" style="left:650px;top:309px;"></zugtt-signal>
<zugtt-signal zugtt-red-channel="46" zugtt-green-channel="47" style="left:940px;top:295px;"></zugtt-signal>
<zugtt-signal zugtt-red-channel="48" style="left:1210px;top:680px;"></zugtt-signal>

<zugtt-signal zugtt-red-channel="49" zugtt-red-two-channel="50" zugtt-green-channel="51" zugtt-yellow-channel="52" zugtt-white-channel="53" style="left:1278px;top:305px"></zugtt-signal>
<zugtt-signal zugtt-red-channel="54" zugtt-green-channel="55" style="left:1352px;top:495px;"></zugtt-signal>
<zugtt-signal zugtt-red-channel="56" zugtt-green-channel="57" style="left:1372px;top:495px;"></zugtt-signal>

<zugtt-light zugtt-light-channel="58" style="left:600px;top:200px;">L</zugtt-light>
<zugtt-light zugtt-light-channel="59" style="left:680px;top:200px;">H</zugtt-light>

<zugtt-buzzer zugtt-buzzer-channel="60" style="left:1160px;top:106px;"></zugtt-buzzer>
</div>
<script type="text/javascript">


var zugttApp = angular.module('zugttApp',[]);

zugttApp.controller('appController', function($scope,$http) {

$scope.ports = [];
for(var i = 0;i < 64;i++) {
$scope.ports.push(i);
}

$scope.on = function(idx) {
$http.get('/api/on/' + idx);   
};
$scope.off = function(idx) {
$http.get('/api/off/' + idx);   
};
$scope.toggle = function(idx) {
$http.get('/api/toggle/' + idx);   
  };
  $scope.beep = function(idx) {
    $http.get('/api/beep/' + idx);   
  };


}).directive('zugttSwitch',function($http) {
  return {
    scope: {
      zugttStraightChannel: "=",
      zugttBentChannel: "=",
    },
    transclude: true,
    template: '<div><ng-transclude></ng-transclude><div class="status" ng-show="straight">|</div><div class="status" ng-show="!straight">|/</div></div>',
    link: function(scope,elem) {
      scope.straight = true;
      scope.straighten = function() {
        $http.get('/api/beep/'+scope.zugttStraightChannel);
        scope.straight = true;
      };
      scope.bent = function() {
        $http.get('/api/beep/' + scope.zugttBentChannel);
        scope.straight = false;
      }
      scope.straighten();
      elem.on('click',function(evt) {
        scope.$apply(function() {
        if(scope.straight) {
          scope.bent();
        } else {
          scope.straighten();
        }
        });
      });
    }
  };
})
.directive('zugttRail',function($http) {
  return {
    scope: {
      zugttRailChannel: "="
    },
    template: '<div ng-class="{active: powered}">= <div class="icon"><span ng-show="powered" class="glyphicon glyphicon-flash" aria-hidden="true"></span></div></div>',
    link: function(scope,elem) {
      scope.powered = false;
      scope.on = function() {
        $http.get('/api/on/'+scope.zugttRailChannel);
        scope.powered = true;
      }
      scope.off = function() {
        $http.get('/api/off/'+scope.zugttRailChannel);
        scope.powered = false;
      }
      elem.on('click',function(evt) {
        if(scope.powered) {
          scope.off();
        } else {
          scope.on();
        }
      });
      scope.off();

    }
  };

})
.directive('zugttSignal',function($http) {
  return {
    scope: {
      zugttRedChannel: "=",
      zugttGreenChannel: "=",
      zugttYellowChannel: "=",
      zugttWhiteChannel: "=",
      zugttRedTwoChannel: "="
    },
    template: '<div class="signal" ng-class="{red: state == 1,green: state == 2,greenYellow: state == 3,redWhite: state == 4}"></div>',
    link: function(scope,elem) {
      scope.state = 0;
      scope.maxState = 1;
      if(typeof(scope.zugttRedChannel) !== "undefined") {
        ++scope.maxState;
      }
      if(typeof(scope.zugttGreenChannel) !== "undefined") {
        ++scope.maxState;
      }
      if(typeof(scope.zugttRedTwoChannel) !== "undefined") {
        scope.maxState = 5;
      }
      
      scope.red = function() {
        $http.get('/api/on/' + scope.zugttRedChannel);
        $http.get('/api/off/' + scope.zugttGreenChannel);
        if(scope.maxState == 5) {
          $http.get('/api/on/' + scope.zugttRedTwoChannel);
          $http.get('/api/off/' + scope.zugttYellowChannel);
          $http.get('/api/off/' + scope.zugttWhiteChannel);
        }
      };

      scope.green = function() {
        $http.get('/api/on/' + scope.zugttGreenChannel);
        $http.get('/api/off/' + scope.zugttRedChannel);
        if(scope.maxState == 5) {
          $http.get('/api/off/' + scope.zugttRedTwoChannel);
          $http.get('/api/off/' + scope.zugttYellowChannel);
          $http.get('/api/off/' + scope.zugttWhiteChannel);
        }
      };
      scope.greenYellow = function() {
        $http.get('/api/on/' + scope.zugttGreenChannel);
        $http.get('/api/on/' + scope.zugttYellowChannel);
        $http.get('/api/off/' + scope.zugttRedChannel);
        $http.get('/api/off/' + scope.zugttRedTwoChannel);
        $http.get('/api/off/' + scope.zugttWhiteChannel);
      };
      scope.redWhite = function() {
        $http.get('/api/off/' + scope.zugttGreenChannel);
        $http.get('/api/off/' + scope.zugttYellowChannel);
        $http.get('/api/on/' + scope.zugttRedChannel);
        $http.get('/api/off/' + scope.zugttRedTwoChannel);
        $http.get('/api/on/' + scope.zugttWhiteChannel);
      };
      scope.off = function() {
        $http.get('/api/off/' + scope.zugttGreenChannel);
        $http.get('/api/off/' + scope.zugttRedChannel);
        if(scope.maxState == 5) {
          $http.get('/api/off/' + scope.zugttRedTwoChannel);
          $http.get('/api/off/' + scope.zugttYellowChannel);
          $http.get('/api/off/' + scope.zugttWhiteChannel);
        }
      };
      elem.on('click',function(evt) {
        scope.state = ++scope.state % scope.maxState;
        console.log(scope.state);
        switch(scope.state) {
          case 0:
            scope.off();
            break;
          case 1:
            scope.red();
            break;
          case 2:
            scope.green();
            break;
          case 3:
            scope.greenYellow();
            break;
          case 4:
            scope.redWhite();
            break;
        }
      });
      scope.off();
    }
};

})
.directive('zugttLight',function($http) {
  return {
    scope: {
      zugttLightChannel: "="
    },
    transclude: true,
 template: '<div ng-class="{active: powered}"><ng-transclude></ng-transclude><div class="icon"><span ng-show="powered" class="glyphicon glyphicon-flash" aria-hidden="true"></span></div></div>',
    link: function(scope,elem) {
      scope.powered = false;
      scope.on = function() {
        $http.get('/api/on/'+scope.zugttLightChannel);
        scope.powered = true;
      }
      scope.off = function() {
        $http.get('/api/off/'+scope.zugttLightChannel);
        scope.powered = false;
      }
      elem.on('click',function(evt) {
        if(scope.powered) {
          scope.off();
        } else {
          scope.on();
        }
      });
      scope.off();
    } 
 
  };

})
.directive('zugttBuzzer',function($http,$timeout) {
  return {
    scope: {
      zugttBuzzerChannel: "="
    },
    template: '<div class="zugtt-buzzer" ng-class="{active: activated}">B</div>',
    link: function(scope,elem) {
      scope.activated = false;
        elem.on('click',function(evt) {
          scope.$apply(function(){

          });
            $http.get('/api/beep/'+scope.zugttBuzzerChannel);
            scope.activated = true;
            $timeout(function(){
              scope.activated = false;
            },800);
        });
    }
  };
});

</script>
</body>
</html>
